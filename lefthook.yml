colors: true
skip_output: [meta, success]

#---------------------------------------------
# Pre-commit checks
#---------------------------------------------
pre-commit:
  parallel: true
  commands:
    lint:
      glob: '*.{js,jsx,ts,tsx,vue}'
      run: |
        echo "ğŸ” Linting code..."
        bun run lint
      skip: [merge, rebase]

    format:
      glob: '*.{js,jsx,ts,tsx,vue,json,md}'
      stage_fixed: true
      run: |
        echo "âœ¨ Formatting code..."
        bun run format
      skip: [merge, rebase]

    typecheck:
      glob: '*.{ts,tsx,vue}'
      run: |
        echo "ğŸ” Type checking..."
        bun run type-check
      skip: [merge, rebase]

    no-debug:
      glob: '*.{js,jsx,ts,tsx,vue}'
      run: |
        echo "ğŸ› Checking for debug code..."
        if grep -l "console\.log\|debugger" {staged_files} 2>/dev/null; then
          echo "âš ï¸  Debug code detected in staged files!"
          echo "Found in:"
          grep -n "console\.log\|debugger" {staged_files} 2>/dev/null || true
          exit 1
        else
          echo "âœ… No debug code found"
        fi
      skip: [merge, rebase]

#---------------------------------------------
# Commit message validation
#---------------------------------------------
commit-msg:
  commands:
    commitlint:
      run: |
        echo "ğŸ“ Validating commit message..."
        bunx --no-install commitlint --edit "$1"

#---------------------------------------------
# Branch operations
#---------------------------------------------
post-merge:
  commands:
    update-deps:
      run: |
        echo "ğŸ“¦ Checking dependencies..."
        if git diff --name-only ORIG_HEAD HEAD | grep -E 'bun\.lock|package\.json' >/dev/null 2>&1; then
          echo "ğŸ“¦ Dependencies changed, updating..."
          bun install
        else
          echo "âœ… No dependency changes detected"
        fi

post-checkout:
  commands:
    setup:
      run: |
        echo "ğŸ”„ Branch checkout detected..."
        # $3 = "1" when switching branches, $1 = previous HEAD, $2 = new HEAD
        if [ "$3" = "1" ]; then
          if git diff --name-only "$1" "$2" | grep -E 'bun\.lock|package\.json' >/dev/null 2>&1; then
            echo "ğŸ“¦ Dependencies changed between branches, updating..."
            bun install
          else
            echo "âœ… No dependency changes between branches"
          fi
        fi

#---------------------------------------------
# Push hooks (optional - for additional safety)
#---------------------------------------------
pre-push:
  commands:
    test:
      run: |
        echo "ğŸ§ª Running tests before push..."
        bun run test
      skip: [merge, rebase]

    build-check:
      run: |
        echo "ğŸ—ï¸  Verifying build..."
        bun run build
      skip: [merge, rebase]
